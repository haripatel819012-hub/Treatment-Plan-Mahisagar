<!DOCTYPE html>
<html lang="gu">
<head>
  <meta charset="UTF-8">
  <title>Treatment Plan - Mahisagar Forest Division</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #fdfdfd; }
    .page { page-break-after: always; padding: 40px; border: 1px solid #000; margin-bottom: 30px; width: 794px; min-height: 1123px; box-sizing: border-box; background: #fff; }
    h1, h2 { text-align: center; margin-bottom: 20px; font-family: 'Noto Sans Gujarati', Arial, sans-serif; }
    h2.green { color: green; }
    .footer { text-align: center; font-weight: bold; font-size: 14px; margin-top: 30px; }
    .pagenum { text-align: center; margin-top: 5px; font-size: 12px; }
    .field { margin-bottom: 12px; }
    label { font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
    th, td { border: 1px solid #000; padding: 6px; text-align: center; }
    th { background-color: #ccffcc; font-weight: bold; }
    .image-box { width: 100%; height: 300px; border: 2px solid #000; margin: 20px 0; display: flex; align-items: center; justify-content: center; overflow: hidden; }
    .image-box img { max-width: 100%; max-height: 100%; object-fit: contain; }
    select.symbol-dropdown { font-weight: bold; color: red; font-family: 'Noto Sans Gujarati', Arial, sans-serif; }
  </style>
</head>
<body>

  <!-- ================= Data Entry Form ================= -->
  <div>
    <h1>Data Entry Form</h1>
    <div class="field">
      <label>રેંજનું નામ:</label>
      <select id="range">
        <option value="લુણાવાડા">લુણાવાડા</option>
        <option value="ખાનપુર">ખાનપુર</option>
        <option value="બાલાસિનોર">બાલાસિનોર</option>
        <option value="સંતરામપુર (પુર્વ)">સંતરામપુર (પુર્વ)</option>
        <option value="સંતરામપુર (પશ્ચિમ)">સંતરામપુર (પશ્ચિમ)</option>
        <option value="મુનપુર">મુનપુર</option>
        <option value="ડીટવાસ">ડીટવાસ</option>
      </select>
    </div>
    <div class="field"><label>રાઉન્ડનું નામ:</label> <input type="text" id="round"></div>
    <div class="field"><label>બીટનું નામ:</label> <input type="text" id="beat"></div>
    <div class="field"><label>સ્થળનું નામ:</label> <input type="text" id="place"></div>
    <div class="field">
      <label>મોડલનું નામ:</label>
      <select id="model">
        <option value="ફોરેસ્ટ મેનેજમેન્ટ એન્ડ ડેવલોપમેન્ટ (બિન આદિવાસી)">ફોરેસ્ટ મેનેજમેન્ટ એન્ડ ડેવલોપમેન્ટ (બિન આદિવાસી)</option>
        <option value="ફોરેસ્ટ મેનેજમેન્ટ એન્ડ ડેવલોપમેન્ટ (આદિવાસી)">ફોરેસ્ટ મેનેજમેન્ટ એન્ડ ડેવલોપમેન્ટ (આદિવાસી)</option>
        <option value="Project for Ecosystem Restoration in Gujarat (PERG)">Project for Ecosystem Restoration in Gujarat (PERG)</option>
        <option value="CAMPA">CAMPA</option>
      </select>
    </div>
    <div class="field"><label>વિસ્તાર:</label> <input type="text" id="area"></div>
    <div class="field"><label>વર્ષ:</label> <input type="text" id="year"></div>
    <div class="field"><label>તૈયાર કરનાર:</label> <input type="text" id="preparedBy"></div>
    <div class="field"><label>મંજૂરી આપનાર:</label> <input type="text" id="approvedBy"></div>
    <div class="field"><label>મંજૂર કાર્ય નંબર અને તારીખ:</label> <input type="text" id="approvalNo"></div>
    <div class="field"><label>બ્લોકની સંખ્યા:</label> <input type="number" id="blockCount" min="1" value="1"></div>
    <div class="field"><label>GPS Map Image:</label> <input type="file" id="gpsImage" accept="image/*"></div>
    <button onclick="generatePages()">Create Full Page</button>
    <button onclick="downloadPDF()">Download PDF</button>
  </div>

  <!-- ================= Generated Pages ================= -->
  <div id="output"></div>

<script>
function generatePages() {
  const range = document.getElementById('range').value;
  const round = document.getElementById('round').value;
  const beat = document.getElementById('beat').value;
  const place = document.getElementById('place').value;
  const model = document.getElementById('model').value;
  const area = document.getElementById('area').value;
  const year = document.getElementById('year').value;
  const preparedBy = document.getElementById('preparedBy').value;
  const approvedBy = document.getElementById('approvedBy').value;
  const approvalNo = document.getElementById('approvalNo').value;
  const blockCount = parseInt(document.getElementById('blockCount').value);
  const gpsImageFile = document.getElementById('gpsImage').files[0];

  let outputHTML = "";

  // Page 1
  outputHTML += `
    <div class="page">
      <h1>Treatment Plan - Mahisagar Forest Division</h1>
      <p><b>રેંજનું નામ:</b> ${range}</p>
      <p><b>રાઉન્ડનું નામ:</b> ${round}</p>
      <p><b>બીટનું નામ:</b> ${beat}</p>
      <p><b>સ્થળનું નામ:</b> ${place}</p>
      <p><b>મોડલનું નામ:</b> ${model}</p>
      <div class="footer">મહિસાગર વન વિભાગ, લુણાવાડા<br>વડોદરા વન વર્તુળ, વડોદરા</div>
      <div class="pagenum">Page 1</div>
    </div>`;

  // Page 2
  outputHTML += `
    <div class="page">
      <h2 class="green">ટ્રીટમેન્ટ પ્લાન</h2>
      <table>
        <tr><td><b>સ્થળ</b></td><td>${place}</td></tr>
        <tr><td><b>યોજના / મોડલ</b></td><td>${model}</td></tr>
        <tr><td><b>વિસ્તાર</b></td><td>${area}</td></tr>
        <tr><td><b>વર્ષ</b></td><td>${year}</td></tr>
        <tr><td><b>વિભાગ</b></td><td>મહિસાગર વન વિભાગ</td></tr>
        <tr><td><b>રેંજ</b></td><td>${range}</td></tr>
        <tr><td><b>રાઉન્ડ</b></td><td>${round}</td></tr>
        <tr><td><b>બીટ</b></td><td>${beat}</td></tr>
        <tr><td><b>તૈયાર કરનાર</b></td><td>${preparedBy}</td></tr>
        <tr><td><b>મંજૂરી આપનાર</b></td><td>${approvedBy}</td></tr>
        <tr><td><b>મંજૂર કાર્ય નંબર અને તારીખ</b></td><td>${approvalNo}</td></tr>
      </table>
      <div class="footer">મહિસાગર વન વિભાગ, લુણાવાડા<br>વડોદરા વન વર્તુળ, વડોદરા</div>
      <div class="pagenum">Page 2</div>
    </div>`;

  // Page 3
  let tableRows = "";
  for (let i = 1; i <= blockCount; i++) {
    tableRows += `
      <tr>
        <td>બ્લોક - ${i}</td>
        <td>
          <select class="symbol-dropdown">
            <option value="○">○</option>
            <option value="□">□</option>
            <option value="△">△</option>
            <option value="☆">☆</option>
          </select>
        </td>
        <td contenteditable="true"></td>
        <td contenteditable="true"></td>
      </tr>`;
  }

  let imageBox = `<div class="image-box"><span>No image uploaded</span></div>`;
  if (gpsImageFile) {
    const imgURL = URL.createObjectURL(gpsImageFile);
    imageBox = `<div class="image-box"><img src="${imgURL}" alt="GPS Map"></div>`;
  }

  outputHTML += `
    <div class="page">
      <h2 class="green">ટ્રીટમેન્ટ મૅપ (દરેક કોન્ટરની GPS રીડિંગ દર્શાવવી)</h2>
      ${imageBox}
      <table>
        <thead>
          <tr>
            <th>બ્લોક નંબર</th>
            <th>ચિન્હ</th>
            <th>વિગત</th>
            <th>વિગત</th>
          </tr>
        </thead>
        <tbody>${tableRows}</tbody>
      </table>
      <div class="footer">મહિસાગર વન વિભાગ, લુણાવાડા<br>વડોદરા વન વર્તુળ, વડોદરા</div>
      <div class="pagenum">Page 3</div>
    </div>`;

  // Page 4
  outputHTML += `
    <div class="page">
      <h2 class="green">પ્લોટની વિગત</h2>
      <table id="manualTable">
        <thead>
          <tr>
            <th>અ.નં.</th>
            <th>વિગત</th>
            <th>ચિન્હ</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td contenteditable="true">1</td>
            <td contenteditable="true"></td>
            <td>
              <select class="symbol-dropdown">
                <option value="○">○</option>
                <option value="□">□</option>
                <option value="△">△</option>
                <option value="☆">☆</option>
              </select>
            </td>
          </tr>
        </tbody>
      </table>
      <h3 style="margin-top:30px;">પ્લોટની સામાન્ય માહિતી</h3>
      <p><b>વર્કિંગ સર્કલ:</b> <span contenteditable="true"></span></p>
      <p><b>ફેલિંગ સિરીઝ:</b> <span contenteditable="true"></span></p>
      <p><b>વરસાદ:</b> <span contenteditable="true"></span></p>
      <div class="footer">મહિસાગર વન વિભાગ, લુણાવાડા<br>વડોદરા વન વર્તુળ, વડોદરા</div>
      <div class="pagenum">Page 4</div>
    </div>`;

  document.getElementById("output").innerHTML = outputHTML;
}

async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "pt", "a4");

  const pages = document.querySelectorAll("#output .page");
  for (let i = 0; i < pages.length; i++) {
    const canvas = await html2canvas(pages[i], { scale: 2 });
    const imgData = canvas.toDataURL("image/png");
    const imgProps = pdf.getImageProperties(imgData);
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
    if (i > 0) pdf.addPage();
    pdf.addImage(imgData, "PNG", 0, 0, pdfWidth, pdfHeight);
  }
  pdf.save("treatment-plan.pdf");
}
</script>

</body>
</html>